{% extends "posture/base.html" %}
{% load static %}
{% block content %}
<div class="profile-page d-flex justify-content-center align-items-center"
    style="min-height: 100vh; background: #f2f5f7; padding: 40px 0;">

    <div class="profile-card p-5 rounded-4 shadow-lg"
        style="width: 95%; max-width: 800px; background: linear-gradient(135deg, #a0e3b2, #ffffff); border-radius: 25px;">

        <!-- Header -->
        <div class="text-center mb-5">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="avatar-wrapper mx-auto mb-3">
                    <img class="profile-pic"
                         src="{% if profile.profile_picture %}{{ profile.profile_picture.url }}{% else %}{% static 'posture/images/default-avatar.png' %}{% endif %}"
                         alt="Profile Picture" />
                    <div class="upload-button">
                        <i class="fa fa-arrow-circle-up" aria-hidden="true"></i>
                    </div>
                    {{ form.profile_picture }}
                </div>
            </form>
            <h2 class="fw-bold" style="color:#2d3436;">{{ user.username }}'s Profile</h2>
        </div>

        <!-- Personal Info -->
        <div class="personal-info mb-5">
            <h3 class="fw-bold mb-3" style="color:#2d3436;">Personal Information</h3>

            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label fw-semibold">First Name</label>
                    <input type="text" class="form-control" value="{{ user.first_name }}" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-semibold">Last Name</label>
                    <input type="text" class="form-control" value="{{ user.last_name }}" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-semibold">Username</label>
                    <input type="text" class="form-control" value="{{ user.username }}" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-semibold">Email</label>
                    <input type="text" class="form-control" value="{{ user.email }}" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-semibold">Age</label>
                    <input type="text" class="form-control" value="{{ profile.age }}" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-semibold">Gender</label>
                    <input type="text" class="form-control" value="{{ profile.gender }}" readonly>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div class="reports-section mb-5">
            <h3 class="fw-bold mb-3" style="color:#2d3436;">Your Reports</h3>

            {% if reports %}
            <ul class="list-group shadow-sm rounded-4">
                {% for report in reports %}
                <li class="list-group-item d-flex justify-content-between align-items-center"
                    style="background: #f8fcf9; border-radius: 12px; margin-bottom: 10px;">
                    <div>
                        <strong>{{ report.title }}</strong><br>
                        <small class="text-muted">Date: {{ report.date|date:"d M Y" }}</small>
                    </div>
                    <a href="{{ report.file.url }}" class="btn btn-success fw-semibold px-3 py-1 rounded-pill">
                        <i class="bi bi-download"></i> Download
                    </a>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <div class="alert alert-warning text-center rounded-4 fw-semibold" style="background: #fff3cd;">
                <i class="bi bi-info-circle"></i> No reports available yet.
            </div>
            {% endif %}
        </div>

        <!-- Forgot Password Button -->
        <div class="text-center mt-4">
            <a href="{% url 'forgot_password' %}" class="btn btn-outline-danger fw-bold px-4 py-2">
                <i class="bi bi-lock"></i> Forgot / Change Password
            </a>
        </div>

    </div>
</div>

<style>
    .avatar-wrapper {
        position: relative;
        height: 180px;
        width: 180px;
        margin: 50px auto;
        border-radius: 50%;
        overflow: hidden;
        box-shadow: 1px 1px 15px -5px black;
        transition: all .3s ease;

        &:hover {
            transform: scale(1.05);
            cursor: pointer;
        }

        &:hover .profile-pic {
            opacity: .5;
        }

        .profile-pic {
            height: 100%;
            width: 100%;
            transition: all .3s ease;

            &:after {
                font-family: FontAwesome;
                content: "\f007";
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                position: absolute;
                font-size: 190px;
                background: #ecf0f1;
                color: #34495e;
                text-align: center;
            }
        }

        .upload-button {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;

            .fa-arrow-circle-up {
                position: absolute;
                font-size: 234px;
                top: -23px;
                left: -56px;
                text-align: center;
                opacity: 0;
                transition: all .3s ease;
                color: #34495e;
            }

            &:hover .fa-arrow-circle-up {
                opacity: .9;
            }
        }
    }

    input[readonly] {
        background: #f2f5f7;
        border: none;
        box-shadow: inset 3px 3px 6px rgba(0, 0, 0, 0.1),
            inset -3px -3px 6px rgba(255, 255, 255, 0.7);
    }

    .list-group-item {
        transition: all 0.3s ease-in-out;
    }

    .list-group-item:hover {
        transform: scale(1.02);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
</style>
<!-- Add jQuery before your custom script -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
$(document).ready(function () {
    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                $('.profile-pic').attr('src', e.target.result);
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    $(".upload-button").on('click', function() {
        $(".file-upload").click();
    });

    $(".file-upload").on('change', function() {
        readURL(this);
        $(this).closest("form").submit();  // automatically submit
    });
});
</script>


{% endblock %}