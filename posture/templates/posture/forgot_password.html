{% extends "posture/base.html" %}

{% block content %}
<div class="login-page d-flex justify-content-center align-items-center" style="min-height: 90vh; background: #f2f5f7;">
    <div class="login-card p-5 rounded-4 text-center shadow-lg"
        style="width: 420px; background: linear-gradient(135deg, #a0e3b2, #ffffff); border-radius: 25px; position: relative;">

        <h2 class="fw-bold mb-4" style="color: #2d3436;">Change Password</h2>

        <!-- Floating Popup -->
        <div id="formPopup"
            class="position-absolute top-0 start-50 translate-middle-x d-none p-3 rounded shadow text-white"
            style="z-index: 1050; min-width: 250px; text-align:center;"
            data-success-message="{{ success_message|default:'' }}">
        </div>

        <form id="changePasswordForm" method="POST" action="{% url 'forgot_password' %}" novalidate>
            {% csrf_token %}

            <!-- Old Password -->
            <div class="mb-3 text-start">
                <label for="old_password" class="form-label fw-semibold" style="color:#2d3436;">Old Password</label>
                <input type="password" class="form-control neumorphic-input" name="old_password" id="old_password"
                    placeholder="Enter your old password">
                <div id="oldPasswordError" class="form-error">
                    {% if old_password_error %}
                        {{ old_password_error }}
                    {% endif %}
                </div>
            </div>

            <!-- New Password -->
            <div class="mb-3 text-start">
                <label for="new_password" class="form-label fw-semibold" style="color:#2d3436;">New Password</label>
                <input type="password" class="form-control neumorphic-input" name="new_password" id="new_password"
                    placeholder="Enter new password">
                <div id="newPasswordError" class="form-error"></div>
            </div>

            <!-- Confirm New Password -->
            <div class="mb-3 text-start">
                <label for="confirm_password" class="form-label fw-semibold" style="color:#2d3436;">Confirm New Password</label>
                <input type="password" class="form-control neumorphic-input" name="confirm_password" id="confirm_password"
                    placeholder="Confirm new password">
                <div id="confirmPasswordError" class="form-error"></div>
            </div>

            <button type="submit" class="btn neon-btn w-100 mb-3">Change Password</button>
        </form>
    </div>
</div>

<style>
/* Reuse your existing styles */
.neumorphic-input {
    border-radius: 15px;
    border: none;
    padding: 12px 15px;
    background: #f2f5f7;
    color: #2d3436;
    width: 100%;
    box-shadow: inset 6px 6px 12px rgba(0,0,0,0.1), inset -6px -6px 12px rgba(255,255,255,0.7);
    transition: all 0.3s ease;
}
.neumorphic-input:focus {
    outline: none;
    box-shadow: inset 4px 4px 12px rgba(0,0,0,0.15), inset -4px -4px 12px rgba(255,255,255,0.8);
}
.neon-btn {
    border-radius: 20px;
    border: 2px solid #4CAF50;
    background: #ffffff;
    color: #4CAF50;
    font-weight: 700;
    padding: 12px 0;
    font-size: 1rem;
    transition: all 0.3s ease;
}
.neon-btn:hover {
    background: #4CAF50;
    color: #ffffff;
    box-shadow: 0 0 7px #4CAF50;
}
.form-error {
    color: #dc3545;
    font-size: 0.85rem;
    font-weight: 500;
    margin-top: 5px;
    margin-left: 4px;
    text-align: left;
}
</style>

<script>
document.getElementById("changePasswordForm").addEventListener("submit", function(event) {
    let valid = true;

    // Reset client-side errors
    document.getElementById("oldPasswordError").textContent = "";
    document.getElementById("newPasswordError").textContent = "";
    document.getElementById("confirmPasswordError").textContent = "";

    const oldPassword = document.getElementById("old_password").value.trim();
    const newPassword = document.getElementById("new_password").value.trim();
    const confirmPassword = document.getElementById("confirm_password").value.trim();

    if (!oldPassword) {
        document.getElementById("oldPasswordError").textContent = "Old password is required";
        valid = false;
    }

    if (!newPassword) {
        document.getElementById("newPasswordError").textContent = "New password is required";
        valid = false;
    }

    if (!confirmPassword) {
        document.getElementById("confirmPasswordError").textContent = "Please confirm your new password";
        valid = false;
    } else if (newPassword && newPassword !== confirmPassword) {
        document.getElementById("confirmPasswordError").textContent = "Passwords do not match";
        valid = false;
    }

    if (!valid) {
        event.preventDefault();
    }
});

// Show success popup if message exists
document.addEventListener("DOMContentLoaded", function() {
    const popup = document.getElementById("formPopup");
    const message = popup.dataset.successMessage;
    if (message) {
        popup.textContent = message;
        popup.classList.remove("d-none");
        popup.style.background = "#28a745";
        setTimeout(() => {
            popup.classList.add("d-none");
        }, 3000);
    }
});
</script>
{% endblock %}
