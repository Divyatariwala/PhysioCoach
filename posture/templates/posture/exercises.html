{% extends "posture/base.html" %}
{% load static %}

{% block content %}
<div class="exercise-page d-flex flex-column justify-content-center align-items-center" 
     style="min-height: 100vh; background: #f2f5f7; padding: 40px 0;">

    <!-- Card -->
    <div class="exercise-card p-5 rounded-4 shadow-lg" 
         style="width: 90%; max-width: 1000px; background: linear-gradient(135deg, #a0e3b2, #ffffff); border-radius: 25px;">

        <!-- Heading -->
        <h1 class="fw-bold text-center mb-4" style="color:#2d3436;">Exercise Session</h1>

        <!-- Exercise Selector -->
        <div class="mb-4 text-center">
            <label for="exerciseSelect" class="form-label fw-semibold" style="color:#2d3436;">Choose Exercise</label>
            <select id="exerciseSelect" class="form-select neumorphic-input mx-auto" style="max-width:250px;">
                <option value="squat">Squat</option>
                <option value="pushup">Push-up</option>
                <option value="lunge">Lunge</option>
            </select>
        </div>

        <!-- Buttons -->
        <div class="d-flex justify-content-center gap-3 mb-4">
            <button class="btn neon-btn" onclick="startCamera()">Start Workout</button>
            <button class="btn neon-btn-danger" onclick="stopCamera()">Stop Workout</button>
        </div>

        <!-- Video Feed -->
        <div class="d-flex justify-content-center mb-4">
            <div class="position-relative video-container">
                <video id="video" width="640" height="480" autoplay></video>
                <canvas id="overlay" width="640" height="480"></canvas>
            </div>
        </div>

        <!-- Feedback -->
        <p id="feedback" class="fw-bold text-center mt-2" style="color:#2d3436; font-size:1.2rem;"></p>

        <!-- Dashboard -->
        <div class="mt-5">
            <h2 class="fw-bold text-center mb-3" style="color:#2d3436;">Progress Dashboard</h2>
            <canvas id="progressChart" width="600" height="300" class="mx-auto"></canvas>
        </div>
    </div>
</div>

<style>
/* Neumorphic Inputs */
.neumorphic-input {
    border-radius: 15px;
    border: none;
    padding: 12px 15px;
    background: #f2f5f7;
    color: #2d3436;
    box-shadow: inset 6px 6px 12px rgba(0,0,0,0.1), inset -6px -6px 12px rgba(255,255,255,0.7);
    transition: all 0.3s ease;
}
.neumorphic-input:focus {
    outline: none;
    box-shadow: inset 4px 4px 12px rgba(0,0,0,0.15), inset -4px -4px 12px rgba(255,255,255,0.8);
}

/* Buttons */
.neon-btn {
    border-radius: 20px;
    border: 2px solid #4CAF50;
    background: #ffffff;
    color: #4CAF50;
    font-weight: 700;
    padding: 12px 30px;
    font-size: 1rem;
    transition: all 0.3s ease;
}
.neon-btn:hover {
    background: #4CAF50;
    color: #ffffff;
    box-shadow: 0 0 3px #4CAF50, 0 0 7px #4CAF50;
}

.neon-btn-danger {
    border-radius: 20px;
    border: 2px solid #e74c3c;
    background: #ffffff;
    color: #e74c3c;
    font-weight: 700;
    padding: 12px 30px;
    font-size: 1rem;
    transition: all 0.3s ease;
}
.neon-btn-danger:hover {
    background: #e74c3c;
    color: #ffffff;
    box-shadow: 0 0 3px #e74c3c, 0 0 7px #e74c3c;
}

/* Video Container with neumorphism */
.video-container {
    width: 640px;
    height: 480px;
    border-radius: 20px;
    overflow: hidden;
    background: #f2f5f7;
    box-shadow: inset 6px 6px 12px rgba(0,0,0,0.1), inset -6px -6px 12px rgba(255,255,255,0.7);
    position: relative;
}
.video-container video,
.video-container canvas {
    position: absolute;
    left: 0;
    top: 0;
    border-radius: 20px;
}
</style>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module" src="{% static 'posture/js/video_capture.js' %}"></script>
<script type="module" src="{% static 'posture/js/exercise_logic.js' %}"></script>
<script type="module" src="{% static 'posture/js/dashboard.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
